<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Deploying AWS Lambda with Terraform - Gao Haojun</title><link rel="manifest" href="/Blog/manifest.json"><meta name="application-name" content="Gao Haojun"><meta name="msapplication-TileImage" content="/img/favicon.jpeg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Gao Haojun"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Serverless is a hot topic in Cloud, so as Infrastructure as Code(IaC). Infrastructure as code (IaC) tools allow you to manage infrastructure with configuration files rather than through a graphical us"><meta property="og:type" content="blog"><meta property="og:title" content="Deploying AWS Lambda with Terraform"><meta property="og:url" content="http://vincentgaohj.github.io/Blog/2022/04/11/Deploying-AWS-Lambda-with-Terraform/"><meta property="og:site_name" content="Gao Haojun"><meta property="og:description" content="Serverless is a hot topic in Cloud, so as Infrastructure as Code(IaC). Infrastructure as code (IaC) tools allow you to manage infrastructure with configuration files rather than through a graphical us"><meta property="og:locale" content="en_US"><meta property="og:image" content="http://vincentgaohj.github.io/Blog/gallery/Deploying-AWS-Lambda-with-Terraform/bailey_zindel.jpg"><meta property="article:published_time" content="2022-04-11T06:02:44.000Z"><meta property="article:modified_time" content="2022-04-11T10:20:38.000Z"><meta property="article:author" content="Haojun(Vincent) Gao"><meta property="article:tag" content="AWS"><meta property="article:tag" content="Serverless - Terraform"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="http://vincentgaohj.github.io/Blog/gallery/Deploying-AWS-Lambda-with-Terraform/bailey_zindel.jpg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://vincentgaohj.github.io/Blog/2022/04/11/Deploying-AWS-Lambda-with-Terraform/"},"headline":"Deploying AWS Lambda with Terraform","image":["http://vincentgaohj.github.io/Blog/gallery/Deploying-AWS-Lambda-with-Terraform/bailey_zindel.jpg"],"datePublished":"2022-04-11T06:02:44.000Z","dateModified":"2022-04-11T10:20:38.000Z","author":{"@type":"Person","name":"Haojun(Vincent) Gao"},"publisher":{"@type":"Organization","name":"Gao Haojun","logo":{"@type":"ImageObject","url":"http://vincentgaohj.github.io/img/logo.jpg"}},"description":"Serverless is a hot topic in Cloud, so as Infrastructure as Code(IaC). Infrastructure as code (IaC) tools allow you to manage infrastructure with configuration files rather than through a graphical us"}</script><link rel="canonical" href="http://vincentgaohj.github.io/Blog/2022/04/11/Deploying-AWS-Lambda-with-Terraform/"><link rel="icon" href="/Blog/img/favicon.jpeg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/Blog/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?192470116504c325dfc73c99f66225ed";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-N6S845NT1J" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-N6S845NT1J');</script><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 8.0.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/Blog/"><img src="/Blog/img/logo.jpg" alt="Gao Haojun" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/Blog/">Home</a><a class="navbar-item" href="/Blog/archives">Archives</a><a class="navbar-item" href="/Blog/categories">Categories</a><a class="navbar-item" href="/Blog/tags">Tags</a><a class="navbar-item" href="/Blog/about">About</a><a class="navbar-item" href="/Blog/links">Links</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="GitHub" href="https://github.com/VincentGaoHJ"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="/Blog/gallery/Deploying-AWS-Lambda-with-Terraform/bailey_zindel.jpg" alt="Deploying AWS Lambda with Terraform"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-04-11T06:02:44.000Z" title="2022/4/11 14:02:44">2022-04-11</time></span><span class="level-item"><a class="link-muted" href="/Blog/categories/Terraform/">Terraform</a><span> / </span><a class="link-muted" href="/Blog/categories/Terraform/Serverless/">Serverless</a></span><span class="level-item">9 minutes read (About 1400 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Deploying AWS Lambda with Terraform</h1><div class="content"><p>Serverless is a hot topic in Cloud, so as Infrastructure as Code(IaC). Infrastructure as code (IaC) tools allow you to manage infrastructure with configuration files rather than through a graphical user interface. <strong>IaC allows you to build, change, and manage your infrastructure in a safe, consistent, and repeatable way by defining resource configurations that you can version, reuse, and share.</strong></p>
<p>It’s quite easy to get used to Terraform if you are familiar with CloudFormation as they all being tools to implement infrastructure as code on Cloud Provider, such as AWS. <strong>It’s a cornerstone of <a target="_blank" rel="noopener" href="https://www.missioncloud.com/managed-cloud/managed-aws/devops-automation/">DevOps</a>, designed to boost the agility, productivity and quality of work within organizations.</strong></p>
<p><strong>This article will cover: the basic components of deploying lambda, and related step to set up a lambda through Terraform.</strong></p>
<p><a href=""></a></p>
<span id="more"></span>

<p><img src="/Blog/Blog/2022/04/11/Deploying-AWS-Lambda-with-Terraform/lambda_tagging_architecture.png" alt="Deploying AWS Lambda with Terraform‬‏"></p>
<p><strong>A series article will be published to cover several topic including:</strong></p>
<ul>
<li>Difference between Terraform and CloudFormation</li>
<li>Workflow of Setting up Schedule Lambda to Sync Data Between two s3 Bucket.</li>
<li>Automate Terraform with GitHub Actions</li>
<li>Use PGP to Encrypt Your Terraform Secrets</li>
</ul>
<h1 id="Deploy-a-Lambda-Function-with-Terraform"><a href="#Deploy-a-Lambda-Function-with-Terraform" class="headerlink" title="Deploy a Lambda Function with Terraform"></a>Deploy a Lambda Function with Terraform</h1><p><em><strong>Let’s deploy a simple lambda function to AWS using Terraform. Talk is cheap, let’s show you the code.</strong></em></p>
<h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><ul>
<li>Install Terraform CLI<ul>
<li>Install it through <a target="_blank" rel="noopener" href="https://www.terraform.io/downloads.html">Terraform’s website</a>.</li>
<li>Check the version of it to ensure it works using <code>terraform --version</code></li>
</ul>
</li>
<li>Creating AWS IAM User from console<ul>
<li>Ensure IAM user has programmatic access.</li>
<li>Giving it Administrator access permission to ensure followed resources creation.</li>
</ul>
</li>
</ul>
<h2 id="Main-Steps"><a href="#Main-Steps" class="headerlink" title="Main Steps"></a>Main Steps</h2><h3 id="Source-Code-Needed"><a href="#Source-Code-Needed" class="headerlink" title="Source Code Needed"></a>Source Code Needed</h3><p>For this project, let’s create a directory named <code>src</code> to store is source code. Create file <code>hello.py</code> ,which contain followed code:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">lambda_handler</span>(<span class="params">event, context</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    :param event:</span></span><br><span class="line"><span class="string">    :param context:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Event receive: &#x27;</span>, event)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Mission Completed!&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="Define-Variables"><a href="#Define-Variables" class="headerlink" title="Define Variables"></a>Define Variables</h3><p>The next step is to define all the variables in <code>var.tf</code>, all of them can be hard code in other resources definition, but hard to manage them and not to mention reuse them. For that end, variable is suitable to be extracted and define in separate way.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">variable &quot;function_name&quot; &#123;</span><br><span class="line">    default = &quot;hello&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;source_folder&quot; &#123;</span><br><span class="line">  default = &quot;data/&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;source_directory&quot; &#123;</span><br><span class="line">  type    = string</span><br><span class="line">  default = &quot;./src&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;lambda_runtime&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;Lambda Parameter - Runtime.  E.x. python3.6&quot;</span><br><span class="line">  default     = &quot;python3.8&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;lambda_handler&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;Lambda Parameter - Handler reference, e.x. index.lambda_handler&quot;</span><br><span class="line">  default     = &quot;hello.lambda_handler&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">variable &quot;builds_dir&quot; &#123;</span><br><span class="line">  type        = string</span><br><span class="line">  description = &quot;The directory where the lambda zip should be built&quot;</span><br><span class="line">  default     = &quot;lambda_function_payload.zip&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Data-Definition"><a href="#Data-Definition" class="headerlink" title="Data Definition"></a>Data Definition</h3><p>For the lambda function, it needs proper permission to perform manipulation of other sources and it may have multiple permission statement and sometimes hard to read if policies are directly put in main file. <strong>Below is a data sample to give lambda function permission to list all objects in a s3 bucket.</strong></p>
<p><strong>And also, AWS allow zip file to be uploaded for lambda function</strong>, that’s why data type <code>archive_file</code> is needed and it point to the builds directory for zip file, and need to know which folder is the source code folder.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">data &quot;aws_iam_policy_document&quot; &quot;lambda_permissions&quot; &#123;</span><br><span class="line">    statement &#123;</span><br><span class="line">    	actions = [</span><br><span class="line">      		&quot;s3:ListBucket&quot;,</span><br><span class="line">    	]</span><br><span class="line">    	resources = [</span><br><span class="line">      		&quot;arn:aws:s3:::$&#123;var.target_bucket&#125;&quot;,</span><br><span class="line">    	]</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data &quot;archive_file&quot; &quot;zip_the_python_code&quot; &#123;</span><br><span class="line">  	type        = &quot;zip&quot;</span><br><span class="line">	source_dir  = var.source_directory</span><br><span class="line">  	output_path = var.builds_dir</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Lambda-Definition"><a href="#Lambda-Definition" class="headerlink" title="Lambda Definition"></a>Lambda Definition</h3><p>Finally, we get to define the related resources in <code>lambda.tf</code>, it contains three resources:</p>
<ul>
<li><code>lambda_s3_policy</code>: A policy to consume predefined permission in <code>data.tf</code></li>
<li><code>iam_role_for_lambda</code>: An IAM role for lambda to consume role and also attach above policy to the role.</li>
<li><code>schedule_lambda</code>: Lambda function with many definitions:<ul>
<li><code>filename</code> point to the zip file</li>
<li><code>function_name</code> need no explanation</li>
<li><code>runtime</code> define the version and explainer of the function, such as <code>python3.7</code></li>
<li><code>handler</code> take two input (<code>event</code> and <code>context</code>) when function is invoked. For this project <code>hello</code> is the <strong>file name</strong> and <code>lambda_handler</code> is the <strong>method name</strong>.</li>
<li>Predefined <code>role</code> is assigned to the function</li>
<li><code>source_code_hash</code> is aim to detect code change and update when needed since hash will change when the source code change.</li>
<li><code>environment</code> define the variables for function.</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">resource &quot;aws_iam_policy&quot; &quot;lambda_s3_policy&quot; &#123;</span><br><span class="line">	policy = data.aws_iam_policy_document.lambda_permissions.json</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;aws_iam_role&quot; &quot;iam_role_for_lambda&quot; &#123;</span><br><span class="line">  	name               = &quot;iam_role_for_lambda&quot;</span><br><span class="line">  	assume_role_policy = jsonencode(&#123;</span><br><span class="line">    	&quot;Version&quot; : &quot;2012-10-17&quot;,</span><br><span class="line">    	&quot;Statement&quot; : [</span><br><span class="line">      		&#123;</span><br><span class="line">        		&quot;Action&quot; : &quot;sts:AssumeRole&quot;,</span><br><span class="line">        		&quot;Principal&quot; : &#123;</span><br><span class="line">          			&quot;Service&quot; : &quot;lambda.amazonaws.com&quot;</span><br><span class="line">        		&#125;,</span><br><span class="line">        		&quot;Effect&quot; : &quot;Allow&quot;,</span><br><span class="line">        		&quot;Sid&quot; : &quot;&quot;</span><br><span class="line">      		&#125;</span><br><span class="line">    	]</span><br><span class="line">  	&#125;)</span><br><span class="line">  	managed_policy_arns = [aws_iam_policy.lambda_s3_policy.arn]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resource &quot;aws_lambda_function&quot; &quot;meta_schedule_lambda&quot; &#123;</span><br><span class="line">  	filename         = var.builds_dir</span><br><span class="line">  	function_name    = var.function_name</span><br><span class="line">  	handler          = var.lambda_handler</span><br><span class="line">  	runtime          = var.lambda_runtime</span><br><span class="line">  	role             = aws_iam_role.iam_role_for_lambda.arn</span><br><span class="line">  	source_code_hash = data.archive_file.zip_the_python_code.output_base64sha256</span><br><span class="line">  	environment &#123;</span><br><span class="line">    	variables = &#123;</span><br><span class="line">      		TARGET_BUCKET = var.target_bucket</span><br><span class="line">    	&#125;</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Provider-Information"><a href="#Provider-Information" class="headerlink" title="Provider Information"></a>Provider Information</h3><p><code>provider.tf</code> should be noted that the region in which S3 bucket is created, same region should be entered above.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">provider &quot;aws&quot; &#123;</span><br><span class="line">	region = &quot;us-east-1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Run-Command-Line"><a href="#Run-Command-Line" class="headerlink" title="Run Command Line"></a>Run Command Line</h3><p>Now we almost done all the code work. And run some command to deploy:</p>
<ul>
<li><code>terraform init</code> to download all the required plugins.</li>
<li><code>terraform plan</code> to check the integrity of the code.</li>
<li><code>terraform apply</code> to deploy all the resources into AWS cloud. Also, <code>terraform apply -auto-approve</code> could spare you from manually input <code>yes</code> during the procedure to do the confirmation.</li>
</ul>
<p><strong>Well done!</strong> And all we need to do is to check whether resources have been created through AWS Console.</p>
<hr>
<h1 id="Terraform-Lambda-Resources"><a href="#Terraform-Lambda-Resources" class="headerlink" title="Terraform Lambda Resources"></a>Terraform Lambda Resources</h1><p>There are a lot resources in Terraform to provision lambda function and related resources such as attached policies.</p>
<h3 id="aws-lambda-function"><a href="#aws-lambda-function" class="headerlink" title="aws_lambda_function"></a>aws_lambda_function</h3><p>A Lambda function needs code and an IAM role to run a function. Code is deployed on an S3 bucket as a deployment package (zip file).</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">resource <span class="string">&quot;aws_lambda_function&quot;</span> <span class="string">&quot;sample_lambda&quot;</span> <span class="punctuation">&#123;</span></span><br><span class="line">	filename      = <span class="string">&quot;lambda_function_payload.zip&quot;</span></span><br><span class="line">	function_name = <span class="string">&quot;lambda_terraform_function_name&quot;</span></span><br><span class="line">	role          = aws_iam_role.iam_role_for_lambda.arn</span><br><span class="line">	handler       = <span class="string">&quot;data.test&quot;</span></span><br><span class="line">	source_code_hash = filebase64sha256(<span class="string">&quot;lambda_function_payload.zip&quot;</span>)</span><br><span class="line">	runtime = <span class="string">&quot;nodejs12.x&quot;</span></span><br><span class="line">	environment <span class="punctuation">&#123;</span></span><br><span class="line">		variables = <span class="punctuation">&#123;</span></span><br><span class="line">			foo = <span class="string">&quot;bar&quot;</span></span><br><span class="line">			<span class="punctuation">&#125;</span></span><br><span class="line">		<span class="punctuation">&#125;</span></span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>A single resource of <code>aws_lambda_function</code> is not enough, because no permission is granted by default, so it has to be configured with a execution role to allow the function to assume role to get permission it need.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">resource &quot;aws_iam_role&quot; &quot;iam_role_for_lambda&quot; &#123;</span><br><span class="line">name = &quot;iam_role_for_lambda&quot;</span><br><span class="line">assume_role_policy = &lt;&lt;EOF</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Version&quot;: &quot;2012-10-17&quot;,</span><br><span class="line">        &quot;Statement&quot;: [</span><br><span class="line">           &#123;</span><br><span class="line">             &quot;Action&quot;: &quot;sts:AssumeRole&quot;,</span><br><span class="line">             &quot;Principal&quot;: &#123;</span><br><span class="line">               &quot;Service&quot;: &quot;lambda.amazonaws.com&quot;</span><br><span class="line">             &#125;,</span><br><span class="line">             &quot;Effect&quot;: &quot;Allow&quot;,</span><br><span class="line">             &quot;Sid&quot;: &quot;&quot;</span><br><span class="line">           &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">EOF</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="aws-lambda-alias"><a href="#aws-lambda-alias" class="headerlink" title="aws_lambda_alias"></a><a target="_blank" rel="noopener" href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_alias">aws_lambda_alias</a></h2><p>Resource <code>aws_lambda_alias</code>  provide clients with a function identifier that you can update to invoke a different version. It also useful when a lambda function still in test stage and invocation could be split and route to different version of function.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">resource &quot;aws_lambda_alias&quot; &quot;test_lambda_alias&quot; &#123;</span><br><span class="line">	name             = &quot;my_alias&quot;</span><br><span class="line">    description      = &quot;a sample description&quot;</span><br><span class="line">    function_name    = aws_lambda_function.lambda_function_test.arn</span><br><span class="line">    function_version = &quot;1&quot;</span><br><span class="line">    routing_config &#123;</span><br><span class="line">        additional_version_weights = &#123;</span><br><span class="line">            &quot;2&quot; = 0.5</span><br><span class="line">    	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="aws-lambda-function-event-invoke-config"><a href="#aws-lambda-function-event-invoke-config" class="headerlink" title="aws_lambda_function_event_invoke_config"></a><a target="_blank" rel="noopener" href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs/resources/lambda_function_event_invoke_config">aws_lambda_function_event_invoke_config</a></h2><p>Manages an asynchronous invocation configuration for a Lambda Function or Alias. Such as destination configuration:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">resource &quot;aws_lambda_function_event_invoke_config&quot; &quot;example&quot; &#123;</span><br><span class="line">	function_name = aws_lambda_alias.example.function_name</span><br><span class="line">	destination_config &#123;</span><br><span class="line">    	on_failure &#123;</span><br><span class="line">      		destination = aws_sqs_queue.example.arn</span><br><span class="line">    	&#125;</span><br><span class="line">    	on_success &#123;</span><br><span class="line">    		destination = aws_sns_topic.example.arn</span><br><span class="line">    	&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="aws-lambda-layer-version"><a href="#aws-lambda-layer-version" class="headerlink" title="aws_lambda_layer_version"></a>aws_lambda_layer_version</h2><p>This provides a Lambda Layer Version resource. <a target="_blank" rel="noopener" href="https://lumigo.io/aws-serverless-ecosystem/aws-lambda-layers/">Lambda Layers</a> allow you share the reusable code through layers across multiple Lambda functions.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">resource &quot;aws_lambda_layer_version&quot; &quot;lambda_nodejs_layer&quot; &#123;</span><br><span class="line">    filename   = &quot;lambda_nodejs_layer_payload.zip&quot;</span><br><span class="line">    layer_name = &quot;lambda_layer_nodejs&quot;</span><br><span class="line">    compatible_runtimes = [&quot;nodejs12.0&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="aws-lambda-permission"><a href="#aws-lambda-permission" class="headerlink" title="aws_lambda_permission"></a>aws_lambda_permission</h2><p>This resource provides other AWS services, such as S3 and DynamoDB, access to the Lambda function.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">resource &quot;aws_lambda_permission&quot; &quot;allow_s3&quot; &#123;</span><br><span class="line">	statement_id  = &quot;AllowExecutionFromS3&quot;</span><br><span class="line">  	action        = &quot;lambda:InvokeFunction&quot;</span><br><span class="line">  	function_name = aws_lambda_function.s3_lambda.function_name</span><br><span class="line">  	principal     = &quot;events.amazonaws.com&quot;</span><br><span class="line">  	source_arn    = &quot;arn:aws:events:ap-east-2:121112424343:rule/RunDaily&quot;</span><br><span class="line">  	qualifier     = aws_lambda_alias.s3_alias.name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<hr>
<h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><ul>
<li><a target="_blank" rel="noopener" href="https://aws.amazon.com/blogs/apn/terraform-beyond-the-basics-with-aws/">Terraform: Beyond the Basics with AWS</a></li>
</ul>
</div><div class="article-licensing box"><div class="licensing-title"><p>Deploying AWS Lambda with Terraform</p><p><a href="http://vincentgaohj.github.io/Blog/2022/04/11/Deploying-AWS-Lambda-with-Terraform/">http://vincentgaohj.github.io/Blog/2022/04/11/Deploying-AWS-Lambda-with-Terraform/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>Haojun(Vincent) Gao</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2022-04-11</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2022-04-11</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-globe"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/Blog/tags/AWS/">AWS</a><a class="link-muted mr-2" rel="tag" href="/Blog/tags/Serverless-Terraform/">Serverless - Terraform</a></div><div class="sharethis-inline-share-buttons"></div><script src="https://platform-api.sharethis.com/js/sharethis.js#property=62145317b846610019d3dc05&amp;product=inline-share-buttons" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="https://afdian.net/@vincent_gaohj" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>Afdian.net</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/Blog/img/alipay.jpg" alt="Alipay"></span></a><a class="button donate" href="https://www.buymeacoffee.com/gaohaojun" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/Blog/2022/06/22/What-is-Knative-K-for-Kubernetes-Native/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">What is Knative?  K for Kubernetes + Native</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/Blog/2022/02/16/CICD-Deployment-with-AWS-SAM-using-Github-Action/"><span class="level-item">CI/CD Deployment with AWS SAM using Github Action</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://vincentgaohj.github.io/Blog/2022/04/11/Deploying-AWS-Lambda-with-Terraform/';
            this.page.identifier = '2022/04/11/Deploying-AWS-Lambda-with-Terraform/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'vincentgaohj' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><figure class="media-left"><a class="image" href="/Blog/2025/12/20/AWS-Generative-AI-Developer-Professional-%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2%E8%AF%A6%E8%A7%A3/"><img src="/Blog/gallery/AWS-Generative-AI-Developer-Professional-%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2%E8%AF%A6%E8%A7%A3/AWS%20Certified%20Generative%20AI%20Developer%20-%20Professional.png" alt="AWS Certified Generative AI Developer - Professional (AIP-C01) 考试大纲详解"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-12-20T02:31:07.000Z">2025-12-20</time></p><p class="title"><a href="/Blog/2025/12/20/AWS-Generative-AI-Developer-Professional-%E8%80%83%E8%AF%95%E5%A4%A7%E7%BA%B2%E8%AF%A6%E8%A7%A3/">AWS Certified Generative AI Developer - Professional (AIP-C01) 考试大纲详解</a></p><p class="categories"><a href="/Blog/categories/AWS/">AWS</a> / <a href="/Blog/categories/AWS/AWS-Certified-Generative-AI-Developer-Professional/">AWS Certified Generative AI Developer Professional</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Blog/2025/12/10/OpenRouter-%E7%9A%84-100-%E4%B8%87%E4%BA%BF-Tokens-%E5%AE%9E%E8%AF%81%E7%A0%94%E7%A9%B6/"><img src="/Blog/gallery/OpenRouter-100-Tokens/tokens.png" alt="OpenRouter 的 100 万亿 Tokens 实证研究"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-12-10T03:37:07.000Z">2025-12-10</time></p><p class="title"><a href="/Blog/2025/12/10/OpenRouter-%E7%9A%84-100-%E4%B8%87%E4%BA%BF-Tokens-%E5%AE%9E%E8%AF%81%E7%A0%94%E7%A9%B6/">OpenRouter 的 100 万亿 Tokens 实证研究</a></p><p class="categories"><a href="/Blog/categories/AI/">AI</a> / <a href="/Blog/categories/AI/Analytics/">Analytics</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Blog/2025/12/03/TPU%20%E4%B8%8E%20GPU%20%E7%9A%84%E6%9C%AA%E6%9D%A5%E7%AB%9E%E4%BA%89%E6%A0%BC%E5%B1%80%E6%80%81%E5%8A%BF/"><img src="/Blog/gallery/GPU-TPU/tpu-vs-gpu.png" alt="TPU 与 GPU 的未来竞争格局态势"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-12-03T03:38:07.000Z">2025-12-03</time></p><p class="title"><a href="/Blog/2025/12/03/TPU%20%E4%B8%8E%20GPU%20%E7%9A%84%E6%9C%AA%E6%9D%A5%E7%AB%9E%E4%BA%89%E6%A0%BC%E5%B1%80%E6%80%81%E5%8A%BF/">TPU 与 GPU 的未来竞争格局态势</a></p><p class="categories"><a href="/Blog/categories/AI/">AI</a> / <a href="/Blog/categories/AI/Analytics/">Analytics</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Blog/2025/10/14/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BB%B7%E6%A0%BC%E8%B6%8B%E5%8A%BF%E4%B8%8E%E5%AE%9A%E4%BB%B7%E8%89%BA%E6%9C%AF/"><img src="/Blog/gallery/Deploying-AWS-Lambda-with-Terraform/bailey_zindel.jpg" alt="大模型的价格趋势与定价艺术"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-10-14T02:32:09.000Z">2025-10-14</time></p><p class="title"><a href="/Blog/2025/10/14/%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%BB%B7%E6%A0%BC%E8%B6%8B%E5%8A%BF%E4%B8%8E%E5%AE%9A%E4%BB%B7%E8%89%BA%E6%9C%AF/">大模型的价格趋势与定价艺术</a></p><p class="categories"><a href="/Blog/categories/AI/">AI</a> / <a href="/Blog/categories/AI/Analytics/">Analytics</a></p></div></article><article class="media"><figure class="media-left"><a class="image" href="/Blog/2025/09/24/State-of-AI-2025/"><img src="/Blog/gallery/State-of-AI-2025/intelligence.png" alt="State of AI 2025"></a></figure><div class="media-content"><p class="date"><time dateTime="2025-09-24T03:38:07.000Z">2025-09-24</time></p><p class="title"><a href="/Blog/2025/09/24/State-of-AI-2025/">State of AI 2025</a></p><p class="categories"><a href="/Blog/categories/AI/">AI</a> / <a href="/Blog/categories/AI/Analytics/">Analytics</a></p></div></article></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/Blog/categories/AI/"><span class="level-start"><span class="level-item">AI</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/Blog/categories/AI/Analytics/"><span class="level-start"><span class="level-item">Analytics</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li><li><a class="level is-mobile" href="/Blog/categories/AWS/"><span class="level-start"><span class="level-item">AWS</span></span><span class="level-end"><span class="level-item tag">18</span></span></a><ul><li><a class="level is-mobile" href="/Blog/categories/AWS/AWS-Certified-Generative-AI-Developer-Professional/"><span class="level-start"><span class="level-item">AWS Certified Generative AI Developer Professional</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/AWS/AWS-Certified-Machine-Learning-Specialty/"><span class="level-start"><span class="level-item">AWS Certified Machine Learning Specialty</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/AWS/AWS-Certified-Solution-Architect-Associate/"><span class="level-start"><span class="level-item">AWS Certified Solution Architect Associate</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/AWS/Architecture/"><span class="level-start"><span class="level-item">Architecture</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/AWS/Overview/"><span class="level-start"><span class="level-item">Overview</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/AWS/Serverless/"><span class="level-start"><span class="level-item">Serverless</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/Blog/categories/Algorithm/"><span class="level-start"><span class="level-item">Algorithm</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/Blog/categories/Algorithm/Deep-Learning/"><span class="level-start"><span class="level-item">Deep Learning</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/Algorithm/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/Algorithm/NMF/"><span class="level-start"><span class="level-item">NMF</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/Algorithm/Natural-Language-Processing/"><span class="level-start"><span class="level-item">Natural Language Processing</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/Algorithm/Reinforce-Learning/"><span class="level-start"><span class="level-item">Reinforce Learning</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/Blog/categories/Big-Data/"><span class="level-start"><span class="level-item">Big Data</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/Blog/categories/Big-Data/Spark/"><span class="level-start"><span class="level-item">Spark</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/Blog/categories/Cloud-Native/"><span class="level-start"><span class="level-item">Cloud Native</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/Blog/categories/Cloud-Native/Kubernetes/"><span class="level-start"><span class="level-item">Kubernetes</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/Blog/categories/Cloud-Native/Kubernetes/Knative/"><span class="level-start"><span class="level-item">Knative</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/Blog/categories/Development/"><span class="level-start"><span class="level-item">Development</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/Blog/categories/Development/Android/"><span class="level-start"><span class="level-item">Android</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/Development/Full-Stack/"><span class="level-start"><span class="level-item">Full Stack</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/Development/Log-Stack/"><span class="level-start"><span class="level-item">Log Stack</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/Development/SQL/"><span class="level-start"><span class="level-item">SQL</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></li><li><a class="level is-mobile" href="/Blog/categories/English-Study/"><span class="level-start"><span class="level-item">English Study</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/Finance/"><span class="level-start"><span class="level-item">Finance</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/Blog/categories/Finance/Asset-Management/"><span class="level-start"><span class="level-item">Asset Management</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/Finance/Econometrics/"><span class="level-start"><span class="level-item">Econometrics</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/Blog/categories/LaTeX/"><span class="level-start"><span class="level-item">LaTeX</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/Lifestyle/"><span class="level-start"><span class="level-item">Lifestyle</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/Blog/categories/Terraform/"><span class="level-start"><span class="level-item">Terraform</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/Blog/categories/Terraform/Serverless/"><span class="level-start"><span class="level-item">Serverless</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/Blog/tags/AI/"><span class="tag">AI</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/AWS/"><span class="tag">AWS</span><span class="tag">20</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/AWS-Serverless/"><span class="tag">AWS - Serverless</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Android/"><span class="tag">Android</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Apps/"><span class="tag">Apps</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/BERT/"><span class="tag">BERT</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/CNN/"><span class="tag">CNN</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Certified/"><span class="tag">Certified</span><span class="tag">11</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Certified-Machine-Learning-Specialty/"><span class="tag">Certified Machine Learning - Specialty</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Cloud-Native-Kubernetes/"><span class="tag">Cloud Native - Kubernetes</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Clustering/"><span class="tag">Clustering</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Coffee/"><span class="tag">Coffee</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Deep-Learning/"><span class="tag">Deep Learning</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Deep-Learning/"><span class="tag">Deep-Learning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Django/"><span class="tag">Django</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Docker/"><span class="tag">Docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/EKK/"><span class="tag">EKK</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Econometrics/"><span class="tag">Econometrics</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/GPT-2/"><span class="tag">GPT-2</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/JetPack/"><span class="tag">JetPack</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Knative/"><span class="tag">Knative</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Kotlin/"><span class="tag">Kotlin</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/LaTeX/"><span class="tag">LaTeX</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Log/"><span class="tag">Log</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Machine-Learning/"><span class="tag">Machine-Learning</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/MySQL/"><span class="tag">MySQL</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/NLP/"><span class="tag">NLP</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/NMF/"><span class="tag">NMF</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Overview-of-AWS/"><span class="tag">Overview of AWS</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/PyTorch/"><span class="tag">PyTorch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/React/"><span class="tag">React</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Reinforce-Learning/"><span class="tag">Reinforce Learning</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Serverless/"><span class="tag">Serverless</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Serverless-Terraform/"><span class="tag">Serverless - Terraform</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Spark/"><span class="tag">Spark</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/TOEFL/"><span class="tag">TOEFL</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/Blog/tags/Word2Vec/"><span class="tag">Word2Vec</span><span class="tag">1</span></a></div></div></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/Blog/img/self.jpg" alt="Haojun(Vincent) Gao"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Haojun(Vincent) Gao</p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/Blog/archives"><p class="title">51</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/Blog/categories"><p class="title">33</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/Blog/tags"><p class="title">37</p></a></div></div></nav></div></div><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#Deploy-a-Lambda-Function-with-Terraform"><span class="level-left"><span class="level-item">Deploy a Lambda Function with Terraform</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Prerequisite"><span class="level-left"><span class="level-item">Prerequisite</span></span></a></li><li><a class="level is-mobile" href="#Main-Steps"><span class="level-left"><span class="level-item">Main Steps</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Source-Code-Needed"><span class="level-left"><span class="level-item">Source Code Needed</span></span></a></li><li><a class="level is-mobile" href="#Define-Variables"><span class="level-left"><span class="level-item">Define Variables</span></span></a></li><li><a class="level is-mobile" href="#Data-Definition"><span class="level-left"><span class="level-item">Data Definition</span></span></a></li><li><a class="level is-mobile" href="#Lambda-Definition"><span class="level-left"><span class="level-item">Lambda Definition</span></span></a></li><li><a class="level is-mobile" href="#Provider-Information"><span class="level-left"><span class="level-item">Provider Information</span></span></a></li><li><a class="level is-mobile" href="#Run-Command-Line"><span class="level-left"><span class="level-item">Run Command Line</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#Terraform-Lambda-Resources"><span class="level-left"><span class="level-item">Terraform Lambda Resources</span></span></a><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#aws-lambda-function"><span class="level-left"><span class="level-item">aws_lambda_function</span></span></a></li></ul><li><a class="level is-mobile" href="#aws-lambda-alias"><span class="level-left"><span class="level-item">aws_lambda_alias</span></span></a></li><li><a class="level is-mobile" href="#aws-lambda-function-event-invoke-config"><span class="level-left"><span class="level-item">aws_lambda_function_event_invoke_config</span></span></a></li><li><a class="level is-mobile" href="#aws-lambda-layer-version"><span class="level-left"><span class="level-item">aws_lambda_layer_version</span></span></a></li><li><a class="level is-mobile" href="#aws-lambda-permission"><span class="level-left"><span class="level-item">aws_lambda_permission</span></span></a></li></ul></li><li><a class="level is-mobile" href="#References"><span class="level-left"><span class="level-item">References</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/Blog/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/Blog/"><img src="/Blog/img/logo.jpg" alt="Gao Haojun" height="28"></a><p class="is-size-7"><span>&copy; 2026 Haojun(Vincent) Gao</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Gallery" href="https://www.gaohaojun.com/"><i class="fab fa-fighter-jet"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Linkedin" href="https://www.instagram.com/vincent_gaohj/"><i class="fab fa-linkedin"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Instagram" href="https://www.instagram.com/vincent_gaohj/"><i class="fab fa-instagram"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/VincentGaoHJ"><i class="fab fa-github"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/Blog/js/column.js"></script><script src="/Blog/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/Blog/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script src="/Blog/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/Blog/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/Blog/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>